---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "zentral_mdm_cert_asset Resource - terraform-provider-zentral"
subcategory: ""
description: |-
  The resource zentral_mdm_cert_asset manages MDM cert assets.
---

# zentral_mdm_cert_asset (Resource)

The resource `zentral_mdm_cert_asset` manages MDM cert assets.

## Example Usage

```terraform
# First we configure a SCEP issuer for the Okta CA,
# with dynamic SCEP challenges

resource "zentral_mdm_scep_issuer" "okta" {
  name        = "Okta"
  description = "Okta Device Trust CA"

  url       = "https://example.okta.com/pki/000/scep/aaa"
  key_size  = 2048
  key_usage = 1

  backend = "OKTA_CA"
  okta_ca = {
    url      = "https://example.okta.com/api/v1/certificateAuthorities/000/registrationAuthorities/aaa/challenge"
    username = "okta-AAAAAA"
    password = var.okta_challenge_password
  }
}

# Then we configure a Certificate Asset.

resource "zentral_mdm_artifact" "okta-cert" {
  name               = "Okta Certificate"
  type               = "Certificate Asset"
  channel            = "Device"
  platforms          = ["iOS", "iPadOS", "macOS"]
  reinstall_interval = 180 # renew every 180 days
}

# A Certificate Asset artifact is configured with `zentral_mdm_cert_asset` resources.
# ACME and SCEP issuers can be used. Zentral will automatically return
# a `com.apple.asset.credential.acme` or `com.apple.asset.credential.scep`
# depending on the capabilities of the devices and the issuers configuration.

resource "zentral_mdm_cert_asset" "okta-cert-v1" {
  artifact_id = zentral_mdm_artifact.okta-cert.id
  # We configure only a SCEP issuer because Okta doesn't support ACME (yet?).
  scep_issuer_id = zentral_mdm_scep_issuer.okta.id

  # the variables will be subsituted
  subject = [
    {
      type  = "CN",
      value = "$REALM_USER.EMAIL managementAttestation $ENROLLED_DEVICE.SERIAL_NUMBER"
    }
  ]
  ios     = true
  ipados  = true
  macos   = true
  version = 1
}

# We can use the certificate in other declarations, like for
# a `com.apple.configuration.security.identity` for example.

resource "zentral_mdm_artifact" "okta-identity" {
  name      = "Okta Identity"
  type      = "Configuration"
  channel   = "Device"
  platforms = ["iOS", "iPadOS", "macOS"]
}

resource "zentral_mdm_declaration" "okta-identity-v1" {
  artifact_id = zentral_mdm_artifact.okta-identity.id
  source = jsonencode({
    Type        = "com.apple.configuration.security.identity",
    Identifier  = "com.example.okta-identity",
    ServerToken = "8acee36b-bee2-4dd1-972d-a7c8eee36ea5",
    Payload = {
      KeyIsExtractable   = false,
      AllowAllAppsAccess = true,
      # This is substituted with the `Identifier` of the 
      # `com.apple.asset.credential.acme` or `com.apple.asset.credential.scep`
      # generated by the Cert Asset for the device.
      CredentialAssetReference = "ztl:${zentral_mdm_artifact.okta-cert.id}"
    }
  })
  ios     = true
  ipados  = true
  macos   = true
  version = 1
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `artifact_id` (String) `ID` of the cert asset artifact.
- `version` (Number) Version of the cert asset.

### Optional

- `accessible` (String) The keychain accessibility that determines when the keychain item is available for use. Defaults to `Default`.
- `acme_issuer_id` (String) `ID` of the optional MDM ACME issuer that could be used to issue the certificates.
- `default_shard` (Number) The default shard value. Defaults to `100`.
- `excluded_tag_ids` (Set of Number) Machines tagged with one of these tags will not receive the cert asset.
- `ios` (Boolean) Toggles the installation of the cert asset on iOS devices.
- `ios_max_version` (String) Devices with this iOS version or higher will **not** receive this cert asset.
- `ios_min_version` (String) Devices with this iOS version or higher will receive this cert asset.
- `ipados` (Boolean) Toggles the installation of the cert asset on iPadOS devices.
- `ipados_max_version` (String) Devices with this iPadOS version or higher will **not** receive this cert asset.
- `ipados_min_version` (String) Devices with this iPadOS version or higher will receive this cert asset.
- `macos` (Boolean) Toggles the installation of the cert asset on macOS devices.
- `macos_max_version` (String) Devices with this macOS version or higher will **not** receive this cert asset.
- `macos_min_version` (String) Devices with this macOS version or higher will receive this cert asset.
- `scep_issuer_id` (String) `ID` of the MDM SCEP issuer that could be used to issue the certificates.
- `shard_modulo` (Number) The modulo used to calculate the shards. Defaults to `100`.
- `subject` (Attributes Set) A set of relative distinguished names. (see [below for nested schema](#nestedatt--subject))
- `subject_alt_name` (Attributes) The subject's alternative name for the certificate. (see [below for nested schema](#nestedatt--subject_alt_name))
- `tag_shards` (Attributes Set) A set of tag shard values different from the default shard, to determine if the tagged machines will receive the cert asset. (see [below for nested schema](#nestedatt--tag_shards))
- `tvos` (Boolean) Toggles the installation of the cert asset on tvOS devices.
- `tvos_max_version` (String) Devices with this tvOS version or higher will **not** receive this cert asset.
- `tvos_min_version` (String) Devices with this tvOS version or higher will receive this cert asset.

### Read-Only

- `id` (String) `ID` of the cert asset.

<a id="nestedatt--subject"></a>
### Nested Schema for `subject`

Required:

- `type` (String) Type of the RDN. You can represent OIDs as dotted numbers or use shortcuts for country (`C`), locality (`L`), state (`ST`), organization (`O`), organizational unit (`OU`), and common name (`CN`).
- `value` (String) The value of the RDN.


<a id="nestedatt--subject_alt_name"></a>
### Nested Schema for `subject_alt_name`

Optional:

- `dns_name` (String) The DNS name.
- `nt_principal_name` (String) The NT principal name. Use an OID set to `1.3.6.1.4.1.311.20.2.3`.
- `rfc822_name` (String) The RFC 822 email address.
- `uri` (String) The uniform resource identifier (URI).


<a id="nestedatt--tag_shards"></a>
### Nested Schema for `tag_shards`

Required:

- `shard` (Number) The shard for the tag.
- `tag_id` (Number) The `ID` of the tag.
